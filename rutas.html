<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Configurar rutas</title>
  <link rel="stylesheet" href="scoreboard.css">
</head>
<body>
  <h2>Configurar rutas de archivos</h2>
  <div class="form-row">
    <label>Ruta Scoreboard JSON:</label>
    <input id="rutaScoreboard" class="sb-input" style="width:320px;" readonly>
    <button class="sb-btn" onclick="elegirRuta('scoreboard')">Elegir...</button>
  </div>
  <div class="form-row">
    <label>Ruta Bracket JSON:</label>
    <input id="rutaBracket" class="sb-input" style="width:320px;" readonly>
    <button class="sb-btn" onclick="elegirRuta('bracket')">Elegir...</button>
  </div>
  <div class="form-row">
    <label>Ruta Top8 JSON:</label>
    <input id="rutaTop8" class="sb-input" style="width:320px;" readonly>
    <button class="sb-btn" onclick="elegirRuta('top8')">Elegir...</button>
  </div>
  <div class="form-row">
    <label>Ruta API Key:</label>
    <input id="rutaApiKey" class="sb-input" style="width:320px;" readonly>
    <button class="sb-btn" onclick="elegirRuta('apikey')">Elegir...</button>
  </div>
  <div class="form-row" style="justify-content: flex-end;">
    <button class="sb-btn" onclick="guardarTodasLasRutas()">Guardar todo</button>
  </div>
  <script>
    const { ipcRenderer } = require('electron');
    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    async function elegirRuta(tipo) {
      const res = await ipcRenderer.invoke('elegir-ruta', tipo);
      if (res.ok && res.ruta) {
        document.getElementById('ruta' + capitalize(tipo)).value = res.ruta;
        // Guarda todas las rutas actuales
        const rutas = {};
        for (const t of ['scoreboard', 'bracket', 'top8', 'apikey']) {
          rutas[t] = document.getElementById('ruta' + capitalize(t)).value;
        }
        await ipcRenderer.invoke('guardar-rutas', rutas);
      }
    }

    async function guardarTodasLasRutas() {
      console.log('Intentando guardar rutas...');
      const rutas = {};
      for (const t of ['scoreboard', 'bracket', 'top8', 'apikey']) {
        rutas[t] = document.getElementById('ruta' + capitalize(t)).value;
      }
      await ipcRenderer.invoke('guardar-rutas', rutas);
      alert('Â¡Rutas guardadas!');
      window.close();
    }

    // Al cargar rutas.html
    window.addEventListener('DOMContentLoaded', async () => {
      const res = await ipcRenderer.invoke('cargar-rutas');
      if (res.ok && res.rutas) {
        for (const tipo of ['scoreboard', 'bracket', 'top8', 'apikey']) {
          if (res.rutas[tipo]) {
            document.getElementById('ruta' + capitalize(tipo)).value = res.rutas[tipo];
          }
        }
      }
    });
  </script>
</body>
</html>